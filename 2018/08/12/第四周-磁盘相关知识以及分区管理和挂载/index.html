<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>磁盘相关知识以及分区管理和挂载 | Souler ACan’s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="DAY 12认识磁盘CHS和LBA CHS模式 采用24bit位寻址  其中前10位表示cylinder，中间8位表示head，后面6位表示sector  最大寻址空间8GB  LBA模式  LBA是一个整数，通过转换成CHS格式完成磁盘具体寻址  LBA采用48个bit位寻址  最大寻址空间128PB  注意：由于CHS寻址方式的寻址空间大概在8GB以内，所以在磁盘容量小于大概8G时，可以使用C">
<meta property="og:type" content="article">
<meta property="og:title" content="磁盘相关知识以及分区管理和挂载">
<meta property="og:url" content="http://yoursite.com/2018/08/12/第四周-磁盘相关知识以及分区管理和挂载/index.html">
<meta property="og:site_name" content="Souler ACan’s blog">
<meta property="og:description" content="DAY 12认识磁盘CHS和LBA CHS模式 采用24bit位寻址  其中前10位表示cylinder，中间8位表示head，后面6位表示sector  最大寻址空间8GB  LBA模式  LBA是一个整数，通过转换成CHS格式完成磁盘具体寻址  LBA采用48个bit位寻址  最大寻址空间128PB  注意：由于CHS寻址方式的寻址空间大概在8GB以内，所以在磁盘容量小于大概8G时，可以使用C">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-12T15:08:47.367Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="磁盘相关知识以及分区管理和挂载">
<meta name="twitter:description" content="DAY 12认识磁盘CHS和LBA CHS模式 采用24bit位寻址  其中前10位表示cylinder，中间8位表示head，后面6位表示sector  最大寻址空间8GB  LBA模式  LBA是一个整数，通过转换成CHS格式完成磁盘具体寻址  LBA采用48个bit位寻址  最大寻址空间128PB  注意：由于CHS寻址方式的寻址空间大概在8GB以内，所以在磁盘容量小于大概8G时，可以使用C">
  
    <link rel="alternate" href="/atom.xml" title="Souler ACan’s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Souler ACan’s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">who am i ？</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-第四周-磁盘相关知识以及分区管理和挂载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/12/第四周-磁盘相关知识以及分区管理和挂载/" class="article-date">
  <time datetime="2018-08-12T14:00:00.000Z" itemprop="datePublished">2018-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      磁盘相关知识以及分区管理和挂载
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="DAY-12"><a href="#DAY-12" class="headerlink" title="DAY 12"></a>DAY 12</h1><h2 id="认识磁盘"><a href="#认识磁盘" class="headerlink" title="认识磁盘"></a>认识磁盘</h2><p><strong>CHS和LBA</strong></p>
<pre><code>CHS模式
采用24bit位寻址
 其中前10位表示cylinder，中间8位表示head，后面6位表示sector
 最大寻址空间8GB

LBA模式
 LBA是一个整数，通过转换成CHS格式完成磁盘具体寻址
 LBA采用48个bit位寻址
 最大寻址空间128PB

注意：由于CHS寻址方式的寻址空间大概在8GB以内，所以在磁盘容量小于大概8G时，可以使用CHS寻址方式或是LBA寻址方式；在磁盘容量大于大概8GB时，则只能使用LBA寻址方式
</code></pre><p><strong>磁盘的相关术语</strong></p>
<pre><code>track 磁道 10bit 2^10=1024个磁道 0-1023
sector 扇区 6bit 2^6=64个扇区 0-63  每个扇区固定大小512个字节
head 磁头数    8bit 2^8=256 
cylinder 柱面 
</code></pre><p><strong>磁盘分区的优点</strong></p>
<pre><code>优化io性能
提高修复速度
采用不同的文件系统
隔离系统和程序
磁盘配额

注意：没有分区就没有文件系统，没有文件系统就没有文件，用户通过文件系统来管理文件。
</code></pre><p><strong>两种分区：mbr与gpt</strong></p>
<pre><code>MBR分区 ,CHS

使用32位表示扇区数，分区不超过2T
按柱面分区
    0磁道0扇区：512bytes
        446 bytes：boot loader （存放主引导程序）
        64 bytes：分区表 （破坏会导致分区丢失）
            16 bytes：识别分区
                引导标志：
                    80活动分区
                    00非活动分区
        2 bytes：标记位55aa （破坏会导致系统识别不出分区）
    4个主分区：3个主分区和一个扩展分区

GPT分区
    支持更大的分区
</code></pre><hr>
<h2 id="管理分区"><a href="#管理分区" class="headerlink" title="管理分区"></a>管理分区</h2><pre><code>列出块设备
lsblk 
查看块设备的文件系统
lsblk -f
查看磁盘的分区表
     fdisk -l /dev/sdb 
     查看内存中的分区表
     ls /dev/sdb* 
     cat /proc/partitions
     lsblk
     centos 6 中同步内存与磁盘的分区表
         partx -a /dev/sda 读取硬盘加所有的分区
             partx -d --nr &lt;sda后跟着的编号&gt; /dev/sda 删除分区

     centos 7 中同步内存与磁盘的分区表
         partprobe （centos6中无效）
         kpartx -a /dev/sda 
</code></pre><p><strong>fdisk命令</strong> ：创建MBR分区</p>
<pre><code>用法：fdisk [option] /dev/sdb
     交互式选项：
         m 列出所有选项
         P 显示当前硬盘分区
         d 删除分区
         q 直接退出规划
         v 校验分区
         t 更改分区标签id
         n 创建一个新分区
             p 创建主分区
             e 创建扩展分区
                 l 逻辑分区
             +2G  分两个G的大小
         w 结束规划，保存，分区生效
         q 结束规划，不保存退出
option：
     -c 关闭dos报警
     -u 指定以何种单位分区
     -l 列出硬盘信息
</code></pre><p><strong>gdisk命令</strong>：创建GPT分区以及管理MBR和GPT分区</p>
<pre><code>用法：gdisk /dev/sdb
     交互式选项：
         ? 列出所有选项
         p 显示当前硬盘分区
         d 删除分区
         q 直接退出规划
         v 校验分区是否正确
         n 创建一个新分区
             输入分区编号：1-128
             输出分区大小：+1G
             code编号默认即可
         w 结束规划，分区生效
</code></pre><p><strong>parted命令</strong>： 实时生效的命令</p>
<pre><code>parted /dev/sdb mkladel gpt/msdos 创建一个GPT/MBR的分区
parted /dev/sdb mkpart primary 1 100  创建一个99m
parted /dev/sdb print 打印分区信息
parted /dev/sdb rm 分区号  删除指定分区
</code></pre><hr>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><p>分区后必须创建文件系统，提供文件管理的功能</p>
<pre><code>查看系统支持的文件系统
ls /lib/modules/`uname -r`/kernel/fs
</code></pre><p><strong>文件系统的类型：</strong></p>
<pre><code>linux文件系统：
    ext2：适用于/boot分区
     ext3：新增了日志功能，能够帮助系统从非正常关机导致的数据丢失恢复。它通常被用作通用的文件系统，但修复速度慢
     ext4：是ext文件系统的最新版。提供了很多新的特性，包括纳秒级的时间戳、创建和使用巨型文件（16TB）、最大1EB的文件系统，以及修复速度的提升
     xfs：支持最大8EB的文件系统
     btrfs：Oracle 发布，还属于测试阶段，企业中几乎不用此文件系统
     reiserfs：本来是世界最优秀的文件系统，但作者被抓了..就此没落
     swap：模拟内存的文件系统
光盘：iso9660
网络文件系统：NFS、CIFS
集群文件系统：GFS2、OCFS2
分布式文件系统：ceph、fastdfs、moosefs、mofilefs
</code></pre><p><strong>文件系统分类：</strong></p>
<pre><code>日志型文件系统：ext3、ext4、xfs
非日志型文件系统：ext2、vfat 
查看文件系统是否已加载到内存中使用
     lsmod
内核中的模块：ext4、xfs、vfat
用户空间的管理工具：
     mkfs.ext4,
     mkfs.xfs,
     mkfs.vfat
linux的虚拟文件系统：VFS
查看当前支持的文件系统：
cat /proc/filesystems
</code></pre><p><strong>管理文件系统的相关命令</strong></p>
<pre><code>查看超级块备份的位置
     dumpe2fs &lt;分区&gt;
查看ext系列文件系统的元数据
     tune2fs -l  &lt;分区&gt;
查看UUID
     blkid
添加分区acl权限
    tune2fs -o acl &lt;分区&gt;
删除分区acl权限
    tune2fs -o ^acl &lt;分区&gt;
删除日志功能
    tune2fs -O ^has_journal &lt;分区&gt;
增加日志功能
    tune2fs -O has_journal &lt;分区&gt;
更改最大挂载次数为10
     tune2fs -c 10 &lt;分区&gt;
更改当前挂载次数为5
     tune2fs -C 5 &lt;分区&gt;
更改检查时间为一个月
     tune2fs -i 1m &lt;分区&gt;
更改文件系统的UUID
     tune2fs -U `uuidgen` &lt;分区&gt;
</code></pre><p><strong>mkfs命令</strong>： 格式化分区，并创建文件系统，生成UUID</p>
<pre><code>用法：
    mkfs.ext4 &lt;分区&gt;
    mkfs.xfs &lt;分区&gt;
选项：
    -L 添加卷标
</code></pre><p><strong>mke2fs命令：</strong> 专门管理ext系列的工具</p>
<pre><code>用法：mke2fs -t &lt;ext系统类型&gt;
选项：
-b 指定block大小 1024，2048，4096
-t ext2/ext3/ext3 指定管理文件系统
-i # 为数据块中每#个字节创建一个inode
-I # 一个inode记录占用的磁盘空间大小，128--4096
-N # 指定分区中创建#个inode
-m # 改变预留给管理员使用空间的百分比
-L 添加卷标
</code></pre><p><strong>fsck命令：</strong> 文件系统检查</p>
<pre><code>fsck -y &lt;分区&gt;    自动修复ext系列的文件系统，前提需要取消挂载
</code></pre><h2 id="分区、文件以及文件夹挂载"><a href="#分区、文件以及文件夹挂载" class="headerlink" title="分区、文件以及文件夹挂载"></a>分区、文件以及文件夹挂载</h2><p><strong>mount命令</strong></p>
<pre><code>mount基本用法：
    mount &lt;分区&gt; &lt;挂载点&gt;
    mount &lt;文件&gt; &lt;挂载点&gt;
    mount &lt;文件夹&gt; &lt;挂载点&gt;

    查看挂载信息
         cat /etc/mtab = mount
    使用UUID挂载设备（推荐使用该方法，不易出错）
         mount &lt;UUID=..&gt; &lt;挂载点&gt;
    使用卷标挂载设备
         mount LABEL=&quot;&lt;卷标&gt;&quot; &lt;挂载点&gt;
    加卷标 
         e2label &lt;设备&gt; &lt;卷标名&gt;

其他用法：

     使用UUID查找分区
         findfs  UUID=&quot;&quot; /blkid -U UUID
     使用卷标名查找分区
         findfs LABEL=&quot;&quot; /blkid -L LABEL
     不更新mtab （在centos7中不起作用）
         mount -n
         cat /proc/mounts 查看隐藏挂载
     只读方式挂载
         mount -r
     不影响用户使用的同时重新挂载，并更改权限为可读可写
         mount -o remount，rw  &lt;挂载点&gt;
     不影响用户使用的同时重新挂载，并更改权限为只读
         mount -o remount，ro  &lt;挂载点&gt;
     将文件挂载到文件夹中，df无法查看文件的挂载，mount可查看，类似于软链接和硬链接的综合体
         mount -B &lt;文件&gt; &lt;挂载点&gt;
     查看正在访问挂载点的进程
         losf &lt;挂载点&gt;
         fuser -v &lt;挂载点&gt;
     杀死正在访问挂载点的进程（慎用）
         fuser -km &lt;挂载点&gt;
     查看挂载情况
         findmnt &lt;挂载点&gt; 
     重新挂载，并设置挂载点不更新atime，除非使用touch
         mount -o remount,noatime &lt;挂载点&gt;
     重新挂载，并设置挂点的目录不更新atime
         nount -o remount，nodiratime
    使fstab配置文件生效
        mount -a 
     重新挂载，并禁用挂载点所有的可执行程序
         mount -o remount，noexec
     重新挂载，并禁用设备文件
         mount -o remount，nodev
     重新挂载，并禁用suid权限
         mount -o remount，nosuid
     重新挂载，并添加acl权限
         mount -o remount，acl &lt;挂载点&gt;

    注意：
        一个设备可以挂载到多个挂载点
        一个文件夹同一时间只能挂载一个设备
         当挂载点的文件夹最好为空


关于loop设备
     在centos6中，将文件挂载到文件夹上，需要消耗一个loop，默认有8个loop
     手动添加loop设备：
         vim /boot/grub/grub.conf
         寻找行(kernel ...rhgb quiet)，并在该行的末端加入 max_loop=100
         (kernel ...rhgb quiet max_loop=100)保存退出并重启，重启后loop设备会增加到100个。

     在centos6中，将普通文件模拟为设备文件，然后挂到文件夹中
    步骤如下
         touch /app/p1
         mkdit /mnt/p1
         dd if=/dev/zero of=/app/p1 bs=1M count=100
         mkfs.ext4 /app/p1  //将文件作为文件系统
         mount -o loop /app/p1 /mnt/p1  //将文件挂载到文件夹中,此时/app/p1可以作为一个u盘
</code></pre><p><strong>fstab文件：</strong></p>
<pre><code>格式：
    1.分区挂载

        设备名or(UUID)    挂载点      文件系统的类型      相关配置   备份     检查次序
        /dev/sdb1       /mnt/sdb1  ext3           defaults   0      0
    2.文件挂载

        设备名or(UUID)    挂载点      文件系统的类型      相关配置   备份 检查次序
        /app/p1           /mnt/p1    ext4           loop       0      0
    3.文件夹挂载

        设备名or(UUID)    挂载点      文件系统的类型      相关配置   备份     检查次序
        /etc            /mnt/etc   none           bind       0      0

 defaults:默认选项
     rw,suid,dev,exec,auto,nouser,async

注意：永久保存挂载点，需编辑/etc/fstab
        寻找fstab文件中含有auto的挂载项，使其立即生效，自动挂载
             mount -a （仅首次挂载有效） 

当救援模式下，文件不可写时，重新挂载根，即可解决
     mount -o remount,rw /

注意：UUID项最好不要出现引号

    fstab内
     当挂载点出错不影响系统启动，centos6与7一样
     当设备出错，centos6与7有差别
     centos6中，
         当设备出错，导致系统无法启动时，更改/etc/fstab下文件系统的检查次序为0，跳过检查（centos7不可用
     centos7中，
         设备出错将导致系统无法启动，只能通过注释掉出错设备，来恢复系统的正常启动
</code></pre><p><strong>实验：将/home下的数据迁移到一个新的分区</strong></p>
<pre><code>建立一个新的分区
    fdisk /dev/sda
为新建分区创建文件系统
    mkfs.xfs /dev/sda6
在mnt目录下新建挂载点
    mkdir /mnt/home
将分区挂载到挂载点
    mount /dev/sda6 /mnt/home
将当前系统更改为单用户模式，保证维护状态，会断网
    init 1
保证数据完整拷贝情况下，拷贝数据至挂载点中
    cp -av /home/* /mnt/home
编辑fstab文件，新增行，使得系统启动时自动将分区挂在到home目录下
      UUID=..(此处省略一大串字符) /home     xfs   defaults    0 0
使配置文件fstab立刻生效
    mount -a
确认home成功挂载后，将原来的home数据删除，不删则会称为垃圾文件，建议删除
    umount /home      取消挂载点
    umount /mnt/home  取消挂载点
    rm -rf /home/*    删除原来的文件
    mount -a          重新挂载
</code></pre><p><strong>创建swap分区</strong></p>
<pre><code>新建分区
    fdisk &lt;分区&gt;
    注意：在交互式创建分区的过程中，t-&gt;l-&gt;82,最好是加个标签，方便识别，不加也无妨
格式化并创建swap文件系统
    mkswap  &lt;分区&gt;
将swap写进fstab文件中
    默认配置defaults,若想改变优先级,&apos;defaults&apos;改为&apos;pri=10&apos;即可更改优先级的值为10
使fstab中的swap分区生效（此处mount -a 无法使swap分区生效）
    swapon -a 
查看swap内存配置
    swapon -s 或者 cat /proc/swaps
    文件名         文件类型          大小     使用情况  优先级（值越大优先级越高）
    Filename      Type            Size     Used     Priority
   /dev/sda5    partition       2097148   6144     -1
禁用指定的swap分区
    swapoff &lt;分区&gt;
删除swap分区
    需要先禁用swap分区
    再修改fstab
    最后通过fdisk将分区彻底删除
</code></pre><p><strong>实验：将文件作为swap使用</strong></p>
<pre><code>先创建一个大小为1G的文件
    dd if=/dev/zero of=/swapfile bs=1G count=1
创建swap文件系统
    mkswap /swapfile
将配置写到fstab文件中
    过程略
更改权限
    chmod 600 /swapfile
使fstab文件配置生效
    swapon -a
</code></pre><p><strong>关于ISO的挂载与制作</strong></p>
<pre><code> 将光盘挂载到文件夹中
     创建文件夹
         mkdir /mnt/cdrom
     配置fstab
     设备名or(UUID)    挂载点        文件系统的类型      相关配置   备份     检查次序
    /dev/cdrom      /mnt/cdrom   iso9660          defaults    0      0
    使配置生效，挂载光盘
        mount -a

创建iso文件
    cp /dev/sr0 /app/centos7.iso

挂载iso
    创建文件夹
        mkdir /mnt/iso
    将iso挂载到文件中
        mount /app/centos7.iso /mnt/iso

将etc文件夹制作成iso文件
    mkisofs -r -o ect.iso /etc/

弹出光驱
    eject
</code></pre><p><strong>关于USB</strong></p>
<pre><code>查看usb设备
    lsusb
强制把内存中的数据写到u盘中
    sync，多敲几次，防止写入失败
</code></pre><p>知识穿插：</p>
<pre><code>超级块记录了分区的元数据，超级块会有备份，分别存于1,3,5,7,9五个块组中
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/12/第四周-磁盘相关知识以及分区管理和挂载/" data-id="cjl0wgxta0003nsis1vbnptpb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/08/15/第五周-RAID/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          RAID知识点以及命令dd、du、df
        
      </div>
    </a>
  
  
    <a href="/2018/08/09/第四周-rmp命令、yum命令、编译安装实例/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">rmp命令、yum命令、编译安装实例</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/15/第五周-RAID/">RAID知识点以及命令dd、du、df</a>
          </li>
        
          <li>
            <a href="/2018/08/12/第四周-磁盘相关知识以及分区管理和挂载/">磁盘相关知识以及分区管理和挂载</a>
          </li>
        
          <li>
            <a href="/2018/08/09/第四周-rmp命令、yum命令、编译安装实例/">rmp命令、yum命令、编译安装实例</a>
          </li>
        
          <li>
            <a href="/2018/08/07/第四周-文件查找以及打包压缩/">文件查找以及打包压缩</a>
          </li>
        
          <li>
            <a href="/2018/08/05/第三周-shell脚本编程基础知识/">shell脚本编程基础知识</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 ACan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>