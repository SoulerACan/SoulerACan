<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>进程和计划任务以及shell编程进阶 | Souler ACan’s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="第七周进程概念内核的功能：    进程管理、文件系统、网络功能、内存管理、驱动程序、安全功能等   进程(process)：    指正在执行中的程序，占用内存空间    进程编号：PID,用来标记各个进程    进程元数据：PID,UID,GID    进程存在生命期   进程数据结构：    task struct：Linux内核存储进程信息的数据结构格式    task list：多个任务的">
<meta property="og:type" content="article">
<meta property="og:title" content="进程和计划任务以及shell编程进阶">
<meta property="og:url" content="http://yoursite.com/2018/09/02/第七周-进程和计划任务以及shell编程进阶/index.html">
<meta property="og:site_name" content="Souler ACan’s blog">
<meta property="og:description" content="第七周进程概念内核的功能：    进程管理、文件系统、网络功能、内存管理、驱动程序、安全功能等   进程(process)：    指正在执行中的程序，占用内存空间    进程编号：PID,用来标记各个进程    进程元数据：PID,UID,GID    进程存在生命期   进程数据结构：    task struct：Linux内核存储进程信息的数据结构格式    task list：多个任务的">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-09-02T13:19:02.667Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="进程和计划任务以及shell编程进阶">
<meta name="twitter:description" content="第七周进程概念内核的功能：    进程管理、文件系统、网络功能、内存管理、驱动程序、安全功能等   进程(process)：    指正在执行中的程序，占用内存空间    进程编号：PID,用来标记各个进程    进程元数据：PID,UID,GID    进程存在生命期   进程数据结构：    task struct：Linux内核存储进程信息的数据结构格式    task list：多个任务的">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Souler ACan’s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">This is hexo theme</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-第七周-进程和计划任务以及shell编程进阶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/02/第七周-进程和计划任务以及shell编程进阶/" class="article-date">
  <time datetime="2018-09-02T13:00:00.000Z" itemprop="datePublished">2018-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      进程和计划任务以及shell编程进阶
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="第七周"><a href="#第七周" class="headerlink" title="第七周"></a>第七周</h1><h2 id="进程概念"><a href="#进程概念" class="headerlink" title="进程概念"></a>进程概念</h2><p><strong>内核的功能：</strong><br>    进程管理、文件系统、网络功能、内存管理、驱动程序、安全功能等  </p>
<p><strong>进程(process)：</strong><br>    指正在执行中的程序，占用内存空间<br>    进程编号：PID,用来标记各个进程<br>    进程元数据：PID,UID,GID<br>    进程存在生命期  </p>
<p><strong>进程数据结构：</strong><br>    task struct：Linux内核存储进程信息的数据结构格式<br>    task list：多个任务的task struct组成的链表   </p>
<p><strong>task命令</strong><br>    task -cp 0 <pid> 把进程绑定在第一个CPU上<br><strong>进程precess创建：</strong></pid></p>
<pre><code>操作系统中的第一个进程：  
    centos6中的第一个进程init  
    centos7中的第一个进程systemd  

进程：由父进程创建,CoW机制 
    进程有父进程和子进程、进程又可创建多个线程
    CoW机制：写实复制
        写时复制（Copy-on-Write，也缩写为COW），顾名思义，就是在写入时才真正复制一份内存进行修改。
        fork()、clone()
    线程(thread)：
        在pstree中
            {}表示线程
        一个进程中至少有一个线程
        同一个进程中的线程共享进程资源
</code></pre><p><strong>pstree命令</strong>  </p>
<pre><code>用于查看进程树  
选项：  
-p 查看进程树和pid
</code></pre><h2 id="进程的状态和优先级"><a href="#进程的状态和优先级" class="headerlink" title="进程的状态和优先级"></a>进程的状态和优先级</h2><p><strong>基本状态</strong></p>
<p>进程在其生命周期内，由于系统中各进程之间的相互制约关系及系统的运行环境的变化，使得进程的状态也在不断地发生变化。通常进程有以下五种状态，前三种是进程的基本状态。</p>
<pre><code>就绪状态：
    进程已处于准备运行的状态，即进程获得了除处理机之外的一切所需资源，一旦得到处理机即可运行
阻塞状态：
    又称等待状态：进程正在等待某一事件而暂停运行，如等待某资源为可用（不包括处理机）或等待输入/输出完成。即使处理机空闲，该进程也不能运行。
运行状态：
    进程正在处理机上运行。在单处理机环境下，每一时刻最多只有一个进程处于运行状态
创建状态：
    进程正在被创建，尚未转到就绪状态。创建进程通常需要多个步骤：首先申请一个空白的PCB，并向PCB中填写一些控制和管理进程的信息；然后由系统为该进程分配运行时所必需的资源；最后把该进程转入到就绪状态。
终止状态： 
    进程正从系统中消失，这可能是进程正常结束或其他原因中断退出运行。当进程需要结束运行时，系统首先必须置该进程为结束状态，然后再进一步处理资源释放和回收等工作。
</code></pre><p><strong>状态切换</strong></p>
<pre><code>就绪状态 -&gt; 运行状态：
    处于就绪状态的进程被调度后，获得处理机资源（分派处理机时间片），于是进程由就绪状态转换为运行状态。
运行状态 -&gt; 就绪状态：
    处于运行状态的进程在时间片用完后，不得不让出处理机，从而进程由运行状态转换为就绪状态。此外，在可剥夺的操作系统中，当有更高优先级的进程就 、 绪时，调度程度将正执行的进程转换为就绪状态，让更高优先级的进程执行。
运行状态 -&gt; 阻塞状态：
    当进程请求某一资源（如外设）的使用和分配或等待某一事件的发生（如I/O操作的完成）时，它就从运行状态转换为阻塞状态。进程以系统调用的形式请求操作系统提供服务，这是一种特殊的、由运行用户态程序调用操作系统内核过程的形式。
阻塞状态 -&gt; 就绪状态：
    当进程等待的事件到来时，如I/O操作结束或中断结束时，中断处理程序必须把相应进程的状态由阻塞状态转换为就绪状态。
以下两种状态是不可能发生的：
阻塞状态 -&gt; 运行状态：
    即使给阻塞进程分配CPU，也无法执行，操作系统在进行调度时不会从阻塞队列进行挑选，而是从就绪队列中选取
就绪状态 -&gt; 阻塞状态：
    就绪状态根本就没有执行，谈不上进入阻塞状态
</code></pre><p><strong>DMA设备</strong><br>DMA(Direct Memory Access，直接内存存取) 是所有现代电脑的重要特色，它允许不同速度的硬件装置来沟通，而不需要依赖于 CPU 的大量中断负载。否则，CPU 需要从来源把每一片段的资料复制到暂存器，然后把它们再次写回到新的地方。在这个时间中，CPU 对于其他的工作来说就无法使用。</p>
<pre><code>总结结：内存直接访问，大大提示了CPU的利用率
</code></pre><h2 id="进程优先级："><a href="#进程优先级：" class="headerlink" title="进程优先级："></a>进程优先级：</h2><p><strong>进程优先级</strong>  </p>
<pre><code>系统优先级：  
    数字越小，优先级越高  
    0-139(centos4，5)  
        各有140个运行队列和过期队列  
    0-99(centos6)  
实时优先级：  
    99-0 值最大，优先级越高  
nice优先级：  
    -20到19，对应系统优先级100-139  
原理：CUP时间片切换  
    运行队列与等待队列来回切换  
</code></pre><p><strong>Big O</strong><br>    时间复杂度，用时和规模的关系：<br>        O(1)、<br>        O(logn)、<br>        O(n)、<br>        O(n^2)、<br>        O(2^n)</p>
<h2 id="进程相关概念"><a href="#进程相关概念" class="headerlink" title="进程相关概念"></a>进程相关概念</h2><p><strong>进程内存</strong></p>
<pre><code>page frame：存储页面数据，存储Page 4K
涉及LRU算法：近期最少使用算法，释放内存
    不断的淘汰垫底的数据
物理地址空间和线性地址空间
MMU:负责转换线性和wuli
TLB:保存虚拟地址和物理地址映射关系的缓存
</code></pre><p><strong>IPC:Inter Process Communication</strong></p>
<pre><code>同一主机：
    signal：信号
    shm：shared memory
    semaphore：信号量，一种计数器
不同主机：
    socker：IP和端口号
    RPC：remote procedure call
    MQ：消息队列,Kafka，ActiveMQ    
</code></pre><p><strong>进程状态</strong></p>
<pre><code>Linux内核：抢占式多任务
    进程类型：
    守护进程：daemon，在系统引导过程中启动的进程，和终端无关
    前台进程：跟终端相关，通过终端启动的进程
    两者可互相转化
进程状态：
    运行态：running
    就绪态：ready
    睡眠态：
        可中断：interruptable
        不可中断：uninterruptable
    停止态：stopped
        休眠于内存，但不会被调度，除非手动启动
    僵死态：zombie
        结束进程，父进程结束前，子进程不关闭
</code></pre><h2 id="系统管理工具"><a href="#系统管理工具" class="headerlink" title="系统管理工具"></a>系统管理工具</h2><p><strong>进程的分类</strong></p>
<pre><code>CPU-Bound：CPU密集型，非交互
IO-Bound：IO密集型，交互
linux系统各进程的相关信息均保存在/proc/PID目录下的各文件中
</code></pre><p><strong>pstree命令</strong></p>
<pre><code>显示进程的树状结构
选项：
    -p 显示线程
</code></pre><p><strong>ps工具</strong></p>
<pre><code>ps：process state 进程状态 ，当前进程的快照
三种格式的选项
    UNIX风格的短选项
    BSD风格的选项
    GNU风格的长选项
默认显示当前终端的开启的相关进程
BSD选项：
    a 显示所有和终端有关的进程
    x 显示和终端无关的进程
    u 显示进程所有者的信息
    k &lt;属性&gt;，排序
     -&lt;属性&gt;，倒序
    o 显示指定属性的信息
    f 显示进程树
    L 显示支持的属性列表
UNIX风格选项：
    -C 显示指定命令列表，单个，可多个
    -L 显示线程
    -e 显示所有进程
    -f 显示的属性更加丰富
    -H 显示子进程和父进程
    -u 显示有效的用户ID
    -U 显示真正的用户ID
    -p 显示指定pid的进程
    --ppid 显示属于pid的子进程

常见组合：
    aux
    -ef
    -eFH
    -eo
    axo

eg:按cpu百分比排序
        ps axo pid,%cpu k %cpu

ps输出属性：
    VSZ：虚拟内存集,线性内存
    RSS：常驻内存集
    STAT:进程状态
        R:running
        S:interruptable sleeping
        D:uninterruptable sleeping
        T:stopped
        Z:zombie
        +:前台进程
        l:多线程进程
        L:内存分页并带锁
        N:低优先级进程
        &lt;:高优先级进程
        s:子进程发起者
        ni:nice值
        pri:priority 优先级
        psr：processor CPU编号
        rtprio：实时优先级        
</code></pre><p><strong>进程优先级</strong></p>
<pre><code>优先级调整：
    静态优先级：100-139
    进程默认启动时的nice值为0，优先级为120
    只有根用户才能降低nice值

    nice -n &lt;优先级&gt; PID
    renice -n &lt;优先级&gt; PID
查看nice优先级(ni参数)
    ps axo pid,comm,ni
</code></pre><p><strong>搜索进程</strong></p>
<pre><code>pgrep命令
搜索进程
选项：
    -U 进程发起者
    -u 进程生效者
    -l 显示进程名
    -t &lt;终端&gt; 显示指定终端运行的进程
    -a 显示完整格式的进程名
    -P &lt;PID&gt; 显示指定进程的子进程
pidof
    pidof &lt;进程名&gt; 显示进程是否正常工作以及显示PID
</code></pre><p><strong>系统工具</strong></p>
<pre><code>uptime命令
    显示当前时间，系统已启动时间，当前在线人数，以及系统平均负载情况(1/5/10)
系统平均负载：
    指在特定时间间隔内运行队列中的平均进程数
通常每个CPU内核的当前活动进程数不大于3,那么系统的性能良好。如果每个CPU内核的任务数大于5，那么此主机的性能有严重问题
如果linux主机是一个双核CPU，当Load Average为6的时候说明机器已经被充分使用
</code></pre><p><strong>进程管理工具</strong><br>top工具：可以实时动态地查看系统的整体运行情况，是一个综合了多方信息监测系统性能和运行信息的实用工具。通过top命令所提供的互动式界面，用热键可以管理。</p>
<pre><code>top命令
    选项：
        -d # 指定刷新时间间隔，默认3秒
        -b 显示所有进程
        -n # 刷新指定次数后退出
        -H 线程模式
    内置选项：
        P 以%CPU排序
        M 以%MEM排序
        T 以占据CPU时长排序
        l 显示uptime信息
        t 显示cpu信息
        m 显示memory信息
        s 修改刷新时间间隔
        k 杀死指定进程
    退出：q
    保存文件:W  
</code></pre><p>htop工具：top的花里胡哨版</p>
<pre><code>htop命令(需安装，使用epel源，花里胡哨的，支持鼠标点击)
    选项：
        -d # 指定刷新时间间隔
        -u &lt;username&gt; 仅显示指定用户的进程
        -s 以指定字段进行排序
</code></pre><h2 id="内存工具"><a href="#内存工具" class="headerlink" title="内存工具"></a>内存工具</h2><p><strong>free命令</strong></p>
<pre><code>功能：
    用来查看内存使用情况的主要命令。和top命令相比,它的优点是使用简单,并且只占用很少的系统资源。
选项：
    -h   人类易读格式
    -b 　以Byte为单位显示内存使用情况。 
    -k 　以KB为单位显示内存使用情况。 
    -m 　以MB为单位显示内存使用情况。
    -g   以GB为单位显示内存使用情况。 
    -o 　不显示缓冲区调节列。 
    -s&lt;间隔秒数&gt; 　持续观察内存使用状况。 
    -t 　显示内存总和列。 
    -V 　显示版本信息
</code></pre><p><strong>iostat命令</strong></p>
<pre><code>功能：
    统计CPU和设备IO信息
    通过iostat方便查看CPU、网卡、tty设备、磁盘、CD-ROM 等等设备的活动情况,    负载信息。
选项：
    -C 显示CPU使用情况
    -d 显示磁盘使用情况
    -k 以 KB 为单位显示
    -m 以 M 为单位显示
    -N 显示磁盘阵列(LVM) 信息
    -n 显示NFS 使用情况
    -p[磁盘] 显示磁盘和分区的情况
    -t 显示终端和CPU的信息
    -x 显示详细信息
    -V 显示版本信息
</code></pre><p><strong>pmap命令</strong></p>
<pre><code>功能：
    提供了进程的内存映射，用于显示一个或多个进程的内存状态
用法：pmap &lt;PID&gt;
选项：
    -x extended显示扩展格式
    -d device显示设备格式
    -q quiet不显示header/footer行
    -V 显示版本信息
</code></pre><p><strong>glances命令</strong></p>
<pre><code>功能：
    远程监视 CPU，平均负载，内存，网络流量，磁盘 I/O，其他处理器 和 文件系统 空间的利用情况。
使用方法：
    C/S模式下运行glances命令
    服务端先开启
        glances -s -B &lt;服务端地址&gt;
    客户端连接进去远程监控服务端
        glances -c &lt;服务端地址&gt;
选项：
    -b：显示网络连接速度 Byte/ 秒
    -B @IP|host ：绑定服务器端 IP 地址或者主机名称
    -c @IP|host：连接 glances 服务器端
    -C file：设置配置文件默认是 /etc/glances/glances.conf 
    -d：关闭磁盘 I/O 模块
    -e：显示传感器温度
    -f file：设置输出文件（格式是 HTML 或者 CSV）
    -m：关闭挂载的磁盘模块
    -n：关闭网络模块
    -p PORT：设置运行端口默认是 61209 
    -P password：设置客户端 / 服务器密码
    -s：设置 glances 运行模式为服务器
    -t sec：设置屏幕刷新的时间间隔，单位为秒，默认值为 2 秒，数值许可范围：1~32767 
    -h : 显示帮助信息
    -v : 显示版本信息

交互式选项：
    h ：显示帮助信息
    q ：离开程序退出
    c ：按照 CPU 实时负载对系统进程进行排序
    m ：按照内存使用状况对系统进程排序
    i ：按照 I/O 使用状况对系统进程排序
    p ：按照进程名称排序
    d ：显示磁盘读写状况 
    w ：删除日志文件
    l ：显示日志
    s ：显示传感器信息
    f ：显示系统信息
    1 ：轮流显示每个 CPU 内核的使用情况（次选项仅仅使用在多核 CPU 系统）
</code></pre><p><strong>vmstat工具</strong></p>
<pre><code>功能：
    用于查看虚拟内存信息
用法：
    vmstat n #  
    n表示刷新时间间隔，#表示扫描次数
选项：
    -s 显示内存的统计数据

所显示参数的含义详解
procs:
    r：可运行（正运行或等待运行）进程的个数，和核心数有关
    b：处于不可中断睡眠态的进程个数(被阻塞的队列的长度)

memory：
    swpd: 交换内存的使用总量
    free：空闲物理内存总量
    buffer：用于buffer的内存总量
    cache：用于cache的内存总量
swap:
    si：从磁盘交换进内存的数据速率(kb/s)
    so：从内存交换至磁盘的数据速率(kb/s)
io：
    bi：从块设备读入数据到系统的速率(kb/s)
    bo: 保存数据至块设备的速率
system：
    in: interrupts  每次CUP的中断次数，包括时间中断
    cs: context switch  进程上下文切换速率
cpu：
    us:Timespent running non-kernel code 用户CPU时间
    sy: Time spent running kernel code   系统CPU时间
    id: Time spent idle                  空闲CUP时间
    wa: Time spent waiting for IO        等待IO CPU时间
    st: Time stolen from a virtual machine 从虚拟机中窃取的时间
</code></pre><p><strong>dstat工具</strong></p>
<pre><code>功能：
    结合了vmstat，iostat，ifstat，netstat以及更多的信息
选项：
    -l ：显示负载统计量
    -m ：显示内存使用率（包括used，buffer，cache，free值）
    -r ：显示I/O统计
    -s ：显示交换分区使用情况
    -t ：将当前时间显示在第一行
    –fs ：显示文件系统统计数据（包括文件总数量和inodes值）
    –nocolor ：不显示颜色（有时候有用）
    –socket ：显示网络统计数据
    –tcp ：显示常用的TCP统计
    –udp ：显示监听的UDP接口及其当前用量的一些动态数据
</code></pre><p><strong>iotop工具</strong></p>
<pre><code>功能：
    一个用来监视磁盘I/O使用状况的top类工具。iotop具有与top相似的UI，其中包括PID、用户、I/O、进程等相关信息，能够观察每个进程的在磁盘中的读写速度
内建选项：
    左右箭头：改变排序方式，默认是按IO排序。
    r：改变排序顺序。
    o：只显示有IO输出的进程。
    p：进程/线程的显示方式的切换。
    a：显示累积使用量。
    q：退出。
选项：
    -o：只显示有io操作的进程
    -b：批量显示，无交互，主要用作记录到文件。
    -n NUM：显示NUM次，主要用于非交互式模式。
    -d SEC：间隔SEC秒显示一次。
    -p PID：监控的进程pid。
    -u USER：监控的进程用户。
</code></pre><p><strong>lsof工具</strong></p>
<pre><code>功能：
    用于查看你进程开打的文件，打开文件的进程，进程打开的端口(TCP、UDP)。找回/恢复删除的文件。是十分方便的系统监视工具，因为 lsof 需要访问核心内存和各种文件，所以需要root用户执行。

用法：lsof [参数][文件]
选项：
    -a &lt;程序的绝对路径&gt;  查看进程被谁使用
    -p &lt;PID&gt; 查看进程使用的文件
    -c &lt;程序名&gt; 查看指定程序打开的文件
    -g  列出GID号进程详情
    -d&lt;文件号&gt; 列出占用该文件号的进程
    +d&lt;目录&gt;  列出目录下被打开的文件
    +D&lt;目录&gt;  递归列出目录下被打开的文件
    -n&lt;目录&gt;  列出使用NFS的文件
    -i&lt;条件&gt;  列出符合条件的进程
    -u  列出UID号进程详情
    -h 显示帮助信息
    -v 显示版本信息
eg:
    lsof -i -n 查看所有的网络连接
    lsof -i ：80 -n 查看80端口被谁占用

恢复删除文件，前提是正在使用的文件
lsof|grep &lt;被删除文件&gt;
cd /proc/&lt;PID&gt;/fd/&lt;n&gt;
cat &gt;  &lt;被删除文件&gt; 
</code></pre><p><strong>kill工具</strong><br>    功能：<br>        常用与杀死进程<br>    用法：kill &lt;信号&gt; <pid><br>    选项：<br>        -l 查看可用信号<br>            表示方法：<br>                数字<br>                全称<br>                简称<br>        -1  不关闭进程且重读配置文件<br>        -2  终止正在运行的进程，相当于crtl+c<br>        -3<br>        -9  强制杀死某程序，但无法杀死再生进程<br>        -15 正常的关闭某程序<br>        -18 继续运行<br>        -19 睡眠<br><strong>killall工具</strong></pid></p>
<pre><code>功能：
    用来结束同名的的所有进程
用法：killall [参数] [进程名]
选项：
    -Z 只杀死拥有scontext 的进程
    -e 要求匹配进程名称
    -I 忽略小写
    -g 杀死进程组而不是进程
    -i 交互模式，杀死进程前先询问用户
    -l 列出所有的已知信号名称
    -q 不输出警告信息
    -s 发送指定的信号
    -v 报告信号是否成功发送
    -w 等待进程死亡
    --help 显示帮助信息
    --version 显示版本显示
</code></pre><p><strong>pkill命令</strong></p>
<pre><code>功能：
    搜索并关闭进程，可以按照进程名杀死进程。pkill和killall应用方法差不多，也是直接杀死运行中的程序；如果您想杀掉单个进程，请用kill来杀掉
选项：
    -o：仅向找到的最小（起始）进程号发送信号；
    -n：仅向找到的最大（结束）进程号发送信号；
    -P：指定父进程号发送信号；
    -g：指定进程组；
    -t：指定开启进程的终端。
</code></pre><hr>
<h2 id="作业管理"><a href="#作业管理" class="headerlink" title="作业管理"></a>作业管理</h2><p><strong>作业相关理论知识</strong></p>
<pre><code>前台作业：通过终端启动，且启动后一直占据终端资源
后台作业：可通过终端启动，但启动后即转入后台运行(释放终端)
    后台停止
    后台运行
让作业转入后台：
    1.运行中的作业： ctrl+z
        转入后台休眠
    2.尚未启动的作业：command &amp;
        将其后台作业呼出到前台
后台作业虽然被送往后台运行，但其依然与终端相关；退出终端，将关闭后台作业。如果希望送往后台后，剥离与终端的关系。
常用到命令：
    bg 停止转运行
    kill -18 停止转运行，后台
    kill -19 运行转停止，后台
</code></pre><p><strong>jobs工具</strong><br>    功能：<br>        用于查看当前终端所有作业</p>
<pre><code>bg [job_num] 将后台休眠中的的程序呼出到前台，ctrl+无法将其终止
fg [job_num] 将后台呼出到前台，crtl+c可将其终止
</code></pre><p><strong>断网时的解决方案，剥离与终端的关系</strong></p>
<pre><code>nohub命令
screen命令
</code></pre><p><strong>并行执行，提高效率</strong></p>
<pre><code>并行执行的三种方法
1.
{ 命令&amp; 命令&amp; }  或者  { 命令 } &amp;
2.
    (命令&amp;);(命令&amp;);(命令&amp;)
3.调用脚本
vi all.sh
    f1.sh&amp;
    f2.sh&amp;
    f3.sh&amp;
</code></pre><hr>
<h2 id="任务计划"><a href="#任务计划" class="headerlink" title="任务计划"></a>任务计划</h2><p><strong>at工具</strong> (不常用)</p>
<pre><code>功能：在一个指定的时间执行一个指定任务，只能执行一次，且需要开启atd进程 
交互式命令
    ctrl+D正常退出at命令
    会生成计划任务文件存放于/var/spool/at
计划任务中标准输出以邮件的方式发送
    写在计划任务里的任务不要有标准输出，防止磁盘被撑满
禁止普通用户使用计划任务
    /etc/at.deny 黑名单，优先级低
    /etc/at.allow 白名单，优先级高
    当不存在黑白名单时，表示只有管理员可以设置计划任务，普通用户将没有权限设置计划任务
用法：at [option] time
    time指定某时某分
选项：
    -m 当指定的任务被完成之后，将给用户发送邮件，即使没有标准输出
    -I atq的别名
    -d atrm的别名
    -v 显示任务将被执行的时间
    -c 打印任务的内容到标准输出
    -V 显示版本信息
    -q&lt;列队&gt; 使用指定的列队
    -f&lt;文件&gt; 从指定文件读入任务而不是从标准输入读入
    -t&lt;时间参数&gt; 以时间参数的形式提交要运行的任
time格式：
    1)HH:MM  02:00
        在今日的HH:MM 进行，若该时刻已过，则明天此时执行任务

    2)HH:MM YYYY-MM-DD   02:00 2016-09-20
        规定在某年某月的某一天的特殊时刻进行该项任务 

    3)HH:MM[am|pm] [Month] [Date]
        表示在某月某日或者明天执行该任务
    04pm March 17
    17:20 tomorrow

    4)HH:MM[am|pm] + number [minutes|hours|days|weeks]
        表示在某个时间点再加几个时间后才进行该项任务
    now + 5 min 
    02pm + 3 days
</code></pre><p><strong>关于进程服务开机自启</strong></p>
<pre><code>eg：atd服务
    centos6中:
        chkconfig --list atd  查看开机是否启动
        service atd status 是否当前是启动状态
        service atd start 启动当前服务
        chkconfig atd on 开机启动
        chkconfig atd off 开机关闭
    centos7中:
        systemctl is-enabled atd  查看开机是否启动
        systemctl status atd  是否当前是启动状态
        systemctl start atd  启动当前服务

eg：防火墙服务
    centos6中：
        chkconfig iptables off 开机关闭

        使用vim编辑/etc/sysconfig/selinux文件,将SELINUX=&lt;&gt;  更改为SELINUX=disable
    centos7中:
        systemctl disable firewalld 开机关闭
        使用vim编辑/etc/sysconfig/selinux文件,将SELINUX=&lt;&gt;  更改为SELINUX=disable

eg:ntpd服务，自动同步时间

    步骤1
    ntpdate &lt;ip&gt;
    步骤2
    /etc/ntp.conf
    server &lt;ip&gt; iburst
    server ntp.aliyun.com iburst
    步骤3
    设置为开启启动ntpd服务
    chkconfig ntpd on
    步骤4
    立即启动ntpd服务
    service ntpd start

eg:chrony服务，centos7中同步时间
    (待补充)
</code></pre><h2 id="cron-周期性计划任务-第2个视频，重点待补充"><a href="#cron-周期性计划任务-第2个视频，重点待补充" class="headerlink" title="cron 周期性计划任务  (第2个视频，重点待补充)"></a>cron 周期性计划任务  (第2个视频，重点待补充)</h2><p><strong>cron所涉及的文件</strong></p>
<pre><code>主程序包：cronie
    包含crontab命令
补充程序包：cronie-anacron

维护任务包：crontabs
    相关文件夹
        /etc/cron.daily 系统每天的计划任务
        /etc/cron.hourly 系统每小时的计划任务
        /etc/cron.weekly 系统每周的计划任务
        /etc/cron.monthly 系统每个月的计划任务
run-part 
    用于调用某个文件夹中的所有计划任务
</code></pre><p><strong>anacron系统</strong>(了解下即可)</p>
<pre><code>辅助性工具，由于关机而没有执行的任务，开机自动检测，未执行的任务，自动补充执行计划任务，centos6以后的版本取消anacron服务，由crond服务管理

适用于笔记本电脑、家用电脑台式机，服务器不用。

centos6中
    清除临时文件的计划任务
    /etc/cron.daily/tmpwatch 
centos7中
    清除临时文件
    使用systemd-tmpfiles-setup服务实现
查看anacron的信息
    rpm -qi cronie-anacron 
查看crontab信息
    rpm -ql crontabs 
守护进程所存放文件夹
    /usr/lib/systemd/system/crond.service
</code></pre><p><strong>系统计划任务的配置文件</strong></p>
<pre><code>/etc/contabs文件 
    定义管理员创建的系统任务计划
    当所执行的任务命令较为复杂时，写成脚本再进行调用
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置文件格式：</span></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># For details see man 4 crontabs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br><span class="line">30 2 *  * sun root /root/back.sh</span><br></pre></td></tr></table></figure>
<pre><code>/etc/cron.d/目录
    也用于存放计划任务，使计划任务易于管理

cron的日志文件
    /var/log/cron

特殊的时间格式
    @yearly 每年  
        表示 0 0 1 1 *
    @annually 每年
        表示 0 0 1 1 *  
    @monthly 每月
        表示 0 0 1 * *
    @weekly 每星期
        表示 0 0 * * 0
    @daily 每天
        表示 0 0 * * *
    @hourly 每小时
        表示 0 * * * *
    @reboot 下次开机后的时候
        表示 run once after reboot


&quot;@reboot root reboot&quot; 的解决方案
    开机界面 e
    linux16 在最后加入 rd.break
    按 ctrl+x
    mount 查看根的挂载点
    进入相应位置更改配置文件
    重启即可
</code></pre><p><strong>普通用户创建计划任务</strong></p>
<pre><code>crontab工具
功能：
    通过crontab 命令，我们可以在固定的间隔时间执行指定的系统指令或 shell script脚本。时间间隔的单位可以是分钟、小时、日、月、周及以上的任意组合。这个命令非常适合周期性的日志分析或数据备份等工作。创建计划任务
crontab命令
    crontab -e 调出vim编辑器并手动编辑计划任务
    crontab -l 查看当前用户的计划任务
    crontab -l -u &lt;user&gt; 查看指定用户的计划任务
    crontab -r 删除所有计划任务
    crontab -ir 交互式删除指定计划任务
计划任务存放位置
    /var/spool/cron/
计划任务日志文件
    /var/log/cron
使用前添加环境变量，定义使用何种编辑器来编辑计划任务
    EDITOR=vi; export EDITOR
cron的黑白名单
    /etc/cron.deny 黑名单
    /etc/cron.allow 白名单，优先级高于黑名单
</code></pre><p><strong>注意事项</strong></p>
<pre><code>注意：
    计划任务运行结果的标准输出和错误将以邮件的传给相关用户，将导致产生垃圾信息。
解决方案：
    利用重定向将标准输出和错误重定向到垃圾箱中。
    1.command &gt; /dev/null
    2.command &amp;&gt; /dev/null
对于cron任务来讲，%具有特殊用途；如果在命令中要使用%，则需要转义，将%放置于单引号中，则不可用转义。
</code></pre><p><strong>将计划任务精确到秒</strong></p>
<pre><code>sleep命令
    秒级命令
    用法：sleep &lt;n&gt;[时间单位]
    可用时间单位：
        &lt;n&gt;s 秒，默认不用加
        &lt;n&gt;m 分钟
        &lt;n&gt;h 小时
        &lt;n&gt;d 天数
    eg：每20秒执行一次
        cmd1;sleep 20;cmd1;
    eg：每7分钟执行一次
        cmd1;sleep 420;cmd1;
usleep命令 
    微秒级命令
        1000=1毫秒
        1000000=1秒
    eg：0.5秒执行一次
        usleep 500000
</code></pre><hr>
<h2 id="Shell脚本编程进阶"><a href="#Shell脚本编程进阶" class="headerlink" title="Shell脚本编程进阶"></a>Shell脚本编程进阶</h2><pre><code>shell脚本的三种类型：
    顺序执行
    选择执行
    循环执行

选择执行：
    条件选择if语句
        用法：
        1.单分支
            if  &lt;判断条件语句&gt;;then

            fi
        2.双分支
            if  &lt;判断条件语句&gt;;then

            else

            fi
        3.多分支
            if  &lt;判断条件语句&gt;;then

            elif    &lt;判断条件语句&gt;;then

            elif    &lt;判断条件语句&gt;;then

            elif    &lt;判断条件语句&gt;;then

            else

            fi
    条件判断case语句
        用法：
        case &lt;判断条件&gt; in
        &lt;判断条件&gt;)
            echo 
            ;;
        &lt;判断条件&gt;)
            echo 
            ;;
        &lt;判断条件&gt;)
            echo
            ;;
        .
        .
        .
        *)
            echo
        esac
循环执行    
    for循环语句
        用法：
            for &lt;变量名&gt; in &lt;列表&gt;;do
                循环体
            done
    while循环语句(判断条件为真则这行循环)
        用法：
            while [判断条件];do
                循环体
            done
    until循环语句(判断条件为假则执行循环)
        用法：
            until [判断条件];do
                循环体
            done
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">脚本实例：使用<span class="keyword">if</span>语句判断分数</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"please input score: "</span> num </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$num</span> =~ ^[[:digit:]]+$ ]];<span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$num</span>"</span> -ge 0 -a <span class="string">"<span class="variable">$num</span>"</span> -lt 60 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"not good"</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="string">"<span class="variable">$num</span>"</span> -ge 60 -a <span class="string">"<span class="variable">$num</span>"</span> -lt 80  ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"good"</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="string">"<span class="variable">$num</span>"</span> -ge 80 -a <span class="string">"<span class="variable">$num</span>"</span> -le 100  ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"very good"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"please input a right score"</span></span><br><span class="line">    <span class="keyword">fi</span>  </span><br><span class="line"><span class="keyword">else</span>        </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"please input a number"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">脚本实例：使用<span class="keyword">case</span>语句实现菜单选择</span><br><span class="line">cat &lt;&lt;EOF</span><br><span class="line">1:lanmian</span><br><span class="line">2:huimian</span><br><span class="line">3:daoxiaomian</span><br><span class="line">4:juanbing</span><br><span class="line">5:mifan</span><br><span class="line">EOF</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"please input your choose number: "</span> num                                </span><br><span class="line"><span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">1)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"lamian price is 15"</span>;;</span><br><span class="line">2)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"huimian price is 18"</span>;;</span><br><span class="line">3)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"daoxiaomian price is 13"</span>;;</span><br><span class="line">4)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"juanbing price is 10"</span>;;</span><br><span class="line">5)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"mifan price is 2"</span>;;</span><br><span class="line">*)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"no list"</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">脚本实例：网址扫描器</span><br><span class="line">&gt; /app/iplist.log</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"please input netid: "</span> net</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..254&#125;;<span class="keyword">do</span></span><br><span class="line">    &#123; <span class="keyword">if</span> ping -c1 -w1 <span class="variable">$net</span>.<span class="variable">$i</span> &amp;&gt; /dev/null ;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$net</span>.<span class="variable">$i</span> is up</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$net</span>.<span class="variable">$i</span> &gt; /app/iplist.log</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        ehco <span class="variable">$net</span>.<span class="variable">$i</span> is down</span><br><span class="line">      <span class="keyword">fi</span> &#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/02/第七周-进程和计划任务以及shell编程进阶/" data-id="cjm8xlo7p000afwiscnfgp6y8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/08/15/第五周-RAID/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">RAID知识点以及命令dd、du、df</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    <!-- Featured Tags -->

  
    <!-- Short About -->
<section class="visible-md visible-lg">
    <h5><a href="/about/">ABOUT ME</a></h5>
    <div class="short-about">

        

        

        <!-- SNS Link -->
        <ul class="list-inline">
            
            
            

            

            

            
            
            
            
        </ul>
    </div>
</section>
  
    
  <h5>RECENT POSTS</h3>
  <div class="widget">
    <ul>
      
        <li>
          <a href="/2018/09/02/第七周-进程和计划任务以及shell编程进阶/">进程和计划任务以及shell编程进阶</a>
        </li>
      
        <li>
          <a href="/2018/08/15/第五周-RAID/">RAID知识点以及命令dd、du、df</a>
        </li>
      
        <li>
          <a href="/2018/08/12/第四周-磁盘相关知识以及分区管理和挂载/">磁盘相关知识以及分区管理和挂载</a>
        </li>
      
        <li>
          <a href="/2018/08/09/第四周-rmp命令、yum命令、编译安装实例/">rmp命令、yum命令、编译安装实例</a>
        </li>
      
        <li>
          <a href="/2018/08/07/第四周-文件查找以及打包压缩/">文件查找以及打包压缩</a>
        </li>
      
    </ul>
  </div>

  
    <!-- Friends Blog -->

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 ACan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>